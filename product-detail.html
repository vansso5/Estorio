<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</title>
<link rel="stylesheet" href="customer-style.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css">
<style>
body { font-family: 'Cairo', sans-serif; background:#f5f5f5; margin:0; padding:0; color:#333; }
.container { max-width:1200px; margin:20px auto; padding:0 15px; }

/* âœ… Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ø«Ø§Ø¨Øª */
.top-contact {
  background:#fff;
  padding:10px 0;
  text-align:center;
  font-weight:bold;
  font-size:18px;
  color:#007bff;
  box-shadow:0 2px 5px rgba(0,0,0,0.1);
  position:sticky;
  top:0;
  z-index:1000;
}
.top-contact a {
  color:#007bff;
  text-decoration:none;
}
.top-contact a:hover {
  text-decoration:underline;
}

.swiper { width:100%; height:400px; border-radius:15px; overflow:hidden; margin-bottom:20px; cursor: zoom-in; }
.swiper-slide img { width:100%; height:100%; object-fit:cover; border-radius:15px; transition:0.3s; }

.product-detail-info { background:#fff; padding:20px 25px; border-radius:15px; box-shadow:0 5px 15px rgba(0,0,0,0.1); text-align:center; }
.product-detail-info h2 { margin-bottom:10px; font-size:28px; color:#222; }
.product-detail-info p { margin-bottom:10px; }
.product-detail-info .product-detail-price { font-size:24px; color:#e74c3c; margin-bottom:15px; }
.product-detail-info .product-description { font-size:16px; color:#555; margin-bottom:15px; }

#orderBtn { background:#ff5e57; border:none; padding:12px 25px; font-size:18px; color:#fff; border-radius:50px; transition:0.3s; }
#orderBtn:hover { background:#ff3838; transform:scale(1.05); }

.modal { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; z-index:999; opacity:0; pointer-events:none; transition:0.3s; }
.modal-content { background:#fff; padding:25px 20px; border-radius:15px; width:90%; max-width:400px; display:flex; flex-direction:column; gap:15px; box-shadow:0 10px 25px rgba(0,0,0,0.2); }
.modal.hidden { opacity:0; pointer-events:none; }
.modal:not(.hidden) { opacity:1; pointer-events:auto; }

.modal h3 { text-align:center; margin-bottom:10px; color:#333; }
.modal input, .modal select, .modal textarea { padding:10px 15px; border-radius:10px; border:1px solid #ddd; font-size:16px; width:100%; box-sizing:border-box; transition:0.3s; }
.modal input:focus, .modal select:focus, .modal textarea:focus { border-color:#ff5e57; outline:none; }

#confirmOrderBtn { background:#28a745; border:none; padding:12px 20px; color:#fff; border-radius:50px; font-size:18px; transition:0.3s; }
#confirmOrderBtn:hover { background:#218838; transform:scale(1.05); }

.quantity-selector { display:flex; align-items:center; justify-content:center; gap:10px; margin:10px 0; }
.quantity-selector button { background:#ff5e57; color:#fff; border:none; width:40px; height:40px; font-size:20px; border-radius:50%; transition:0.3s; }
.quantity-selector button:hover { background:#ff3838; transform:scale(1.1); }
#quantityValue { min-width:40px; text-align:center; font-weight:bold; font-size:18px; }

#thankYouModal .modal-content { text-align:center; }
#thankYouModal h3 { font-size:24px; color:#28a745; }
#thankYouModal p { font-size:18px; }

/* âœ… Ù†Ø§ÙØ°Ø© ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© */
.image-preview-modal {
  position: fixed;
  top: 0; left: 0; width: 100%; height: 100%;
  background: rgba(0, 0, 0, 0.85);
  display: flex; align-items: center; justify-content: center;
  z-index: 2000; opacity: 0; pointer-events: none;
  transition: 0.3s;
}
.image-preview-modal.active {
  opacity: 1; pointer-events: auto;
}
.image-preview-modal img {
  max-width: 90%; max-height: 90%; border-radius: 15px;
  box-shadow: 0 0 25px rgba(255,255,255,0.2);
  animation: zoomIn 0.3s ease;
}
@keyframes zoomIn {
  from { transform: scale(0.8); opacity: 0; }
  to { transform: scale(1); opacity: 1; }
}
.close-preview {
  position: absolute; top: 20px; right: 25px;
  background: rgba(255,255,255,0.2);
  color: #fff; border: none; font-size: 30px;
  border-radius: 50%; width: 45px; height: 45px;
  cursor: pointer; transition: 0.3s;
}
.close-preview:hover { background: rgba(255,255,255,0.4); }

@media(max-width:768px) {
  .swiper { height:300px; }
  .product-detail-info h2 { font-size:22px; }
  .product-detail-info .product-detail-price { font-size:20px; }
  #orderBtn, #confirmOrderBtn { font-size:16px; padding:10px 20px; }
}
</style>
</head>
<body>

<!-- âœ… Ø´Ø±ÙŠØ· Ø§Ù„Ø§ØªØµØ§Ù„ Ø§Ù„Ø«Ø§Ø¨Øª -->
<div class="top-contact">
ğŸ“ Ø§ØªØµÙ„ Ø¨Ù†Ø§ Ø¹Ù„Ù‰ 
<a href="tel:0540667186">0540667186</a>
</div>

<div class="container">
  <div id="productDetailContainer"><p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬...</p></div>
</div>

<!-- âœ… Ù†Ø§ÙØ°Ø© ØªÙƒØ¨ÙŠØ± Ø§Ù„ØµÙˆØ±Ø© -->
<div class="image-preview-modal" id="imagePreviewModal">
  <button class="close-preview" id="closePreview">&times;</button>
  <img id="previewImage" src="" alt="ØµÙˆØ±Ø© Ù…ÙƒØ¨Ø±Ø©">
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, child, push, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBUeCV2eX3LgA1X3WcEMcsTIubXN1YlVl4",
  authDomain: "myestore-34f65.firebaseapp.com",
  databaseURL: "https://myestore-34f65-default-rtdb.firebaseio.com",
  projectId: "myestore-34f65",
  storageBucket: "myestore-34f65.appspot.com",
  messagingSenderId: "14078917211",
  appId: "1:14078917211:web:a48eab2a7396c094f7dd7e",
  measurementId: "G-9181DX0XNJ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const container = document.getElementById('productDetailContainer');
const previewModal = document.getElementById('imagePreviewModal');
const previewImage = document.getElementById('previewImage');
const closePreview = document.getElementById('closePreview');

function getProductIdFromUrl() {
  return new URLSearchParams(window.location.search).get('id');
}

async function fetchProductDetails() {
  const productId = getProductIdFromUrl();
  if (!productId) return container.innerHTML = '<p class="error-message">Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…Ø¹Ø±Ù Ø§Ù„Ù…Ù†ØªØ¬.</p>';

  try {
    const snapshot = await get(child(ref(db), `products/${productId}`));
    if (!snapshot.exists()) return container.innerHTML = '<p class="error-message">Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.</p>';

    const product = snapshot.val();
    const images = Array.isArray(product.images) ? product.images : [product.images || 'default.jpg'];
    const swiperSlides = images.map(src => `<div class="swiper-slide"><img src="${src}" alt="ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬"></div>`).join('');

    const wilayas = [
      "Ø£Ø¯Ø±Ø§Ø±","Ø§Ù„Ø´Ù„Ù","Ø§Ù„Ø£ØºÙˆØ§Ø·","Ø£Ù… Ø§Ù„Ø¨ÙˆØ§Ù‚ÙŠ","Ø¨Ø§ØªÙ†Ø©","Ø¨Ø¬Ø§ÙŠØ©","Ø¨Ø³ÙƒØ±Ø©","Ø¨Ø´Ø§Ø±","Ø§Ù„Ø¨Ù„ÙŠØ¯Ø©","Ø§Ù„Ø¨ÙˆÙŠØ±Ø©","ØªÙ…Ù†Ø±Ø§Ø³Øª","ØªØ¨Ø³Ø©","ØªÙ„Ù…Ø³Ø§Ù†","ØªÙŠØ§Ø±Øª","ØªÙŠØ²ÙŠ ÙˆØ²Ùˆ","Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±","Ø§Ù„Ø¬Ù„ÙØ©","Ø¬ÙŠØ¬Ù„","Ø³Ø·ÙŠÙ","Ø³Ø¹ÙŠØ¯Ø©","Ø³ÙƒÙŠÙƒØ¯Ø©","Ø³ÙŠØ¯ÙŠ Ø¨Ù„Ø¹Ø¨Ø§Ø³","Ø¹Ù†Ø§Ø¨Ø©","Ù‚Ø§Ù„Ù…Ø©","Ù‚Ø³Ù†Ø·ÙŠÙ†Ø©","Ø§Ù„Ù…Ø¯ÙŠØ©","Ù…Ø³ØªØºØ§Ù†Ù…","Ø§Ù„Ù…Ø³ÙŠÙ„Ø©","Ù…Ø¹Ø³ÙƒØ±","ÙˆØ±Ù‚Ù„Ø©","ÙˆÙ‡Ø±Ø§Ù†","Ø§Ù„Ø¨ÙŠØ¶","Ø¥Ù„ÙŠØ²ÙŠ","Ø¨Ø±Ø¬ Ø¨ÙˆØ¹Ø±ÙŠØ±ÙŠØ¬","Ø¨ÙˆÙ…Ø±Ø¯Ø§Ø³","Ø§Ù„Ø·Ø§Ø±Ù","ØªÙ†Ø¯ÙˆÙ","ØªÙŠØ³Ù…Ø³ÙŠÙ„Øª","Ø§Ù„ÙˆØ§Ø¯ÙŠ","Ø®Ù†Ø´Ù„Ø©","Ø³ÙˆÙ‚ Ø£Ù‡Ø±Ø§Ø³","ØªÙŠØ¨Ø§Ø²Ø©","Ù…ÙŠÙ„Ø©","Ø¹ÙŠÙ† Ø§Ù„Ø¯ÙÙ„Ù‰","Ø§Ù„Ù†Ø¹Ø§Ù…Ø©","Ø¹ÙŠÙ† ØªÙ…ÙˆØ´Ù†Øª","ØºØ±Ø¯Ø§ÙŠØ©","ØºÙ„ÙŠØ²Ø§Ù†","ØªÙŠÙ…ÙŠÙ…ÙˆÙ†","Ø¨Ø±Ø¬ Ø¨Ø§Ø¬ÙŠ Ù…Ø®ØªØ§Ø±","Ø£ÙˆÙ„Ø§Ø¯ Ø¬Ù„Ø§Ù„","Ø¨Ù†ÙŠ Ø¹Ø¨Ø§Ø³","Ø¥Ù† ØµØ§Ù„Ø­","Ø¥Ù† Ù‚Ø²Ø§Ù…","ØªÙ‚Ø±Øª","Ø¬Ø§Ù†Øª","Ø§Ù„Ù…ØºÙŠØ±","Ø§Ù„Ù…Ù†ÙŠØ¹Ø©"
    ];

    const wilayaOptions = wilayas.map(w => `<option value="${w}">${w}</option>`).join('');

    container.innerHTML = `
      <div class="swiper mySwiper"><div class="swiper-wrapper">${swiperSlides}</div><div class="swiper-pagination"></div></div>
      <div class="product-detail-info">
        <h2>${product.name}</h2>
        <p class="product-detail-price">
  ${product.oldPrice ? `<span style="text-decoration: line-through; color: #999; font-size: 18px; margin-left: 10px;">${Number(product.oldPrice).toLocaleString()} Ø¯Ø¬</span>` : ''}
  <span style="color: #e74c3c; font-weight: bold;">${Number(product.newPrice).toLocaleString()} Ø¯Ø¬</span>
</p>
        <p class="product-description">${product.description || ''}</p>
        <button id="orderBtn">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø¢Ù†</button>
      </div>

      <div id="orderModal" class="modal hidden">
        <div class="modal-content">
          <h3>Ø£Ø¯Ø®Ù„ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
          <input type="text" id="fname" placeholder="Ø§Ù„Ø§Ø³Ù…">
          <input type="text" id="lname" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
          <input type="text" id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">

          <select id="wilaya">
            <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ„Ø§ÙŠØ©</option>
            ${wilayaOptions}
          </select>
          <input type="text" id="commune" placeholder="Ø§Ù„Ø¨Ù„Ø¯ÙŠØ© (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ)">
          <input type="text" id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒØ§Ù…Ù„">

          <div class="quantity-selector">
            <button type="button" id="decreaseQty">-</button>
            <span id="quantityValue">1</span>
            <button type="button" id="increaseQty">+</button>
          </div>

          <select id="deliveryType">
            <option value="Ø§Ù„Ù…Ù†Ø²Ù„">ØªÙˆØµÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ù…Ù†Ø²Ù„</option>
            <option value="Ù…ÙƒØªØ¨ Ø§Ù„Ø´Ø±ÙƒØ©">Ø¥Ù„Ù‰ Ù…ÙƒØªØ¨ Ø§Ù„Ø´Ø±ÙƒØ©</option>
          </select>

          <textarea id="note" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)" rows="3"></textarea>
          <button id="confirmOrderBtn">ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨</button>
        </div>
      </div>

      <div id="thankYouModal" class="modal hidden">
        <div class="modal-content">
          <h3>Ø´ÙƒØ±Ù‹Ø§ Ù„Ø·Ù„Ø¨Ùƒ!</h3>
          <p>ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ â¤ï¸</p>
          <p id="orderIdDisplay" style="font-weight:bold; color:#555;"></p>
        </div>
      </div>
    `;

    const swiper = new Swiper(".mySwiper", { pagination: { el: ".swiper-pagination", clickable: true } });

    // âœ… Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„ØµÙˆØ±Ø© ÙŠØªÙ… ØªÙƒØ¨ÙŠØ±Ù‡Ø§
    document.querySelectorAll('.swiper-slide img').forEach(img => {
      img.addEventListener('click', () => {
        previewImage.src = img.src;
        previewModal.classList.add('active');
      });
    });

    closePreview.addEventListener('click', () => previewModal.classList.remove('active'));
    previewModal.addEventListener('click', e => { if(e.target === previewModal) previewModal.classList.remove('active'); });

    // Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙƒÙ…Ø§ Ù‡ÙŠ (Ø²Ø± Ø§Ù„Ø·Ù„Ø¨ ÙˆØºÙŠØ±Ù‡)
    const orderBtn = document.getElementById("orderBtn");
    const orderModal = document.getElementById("orderModal");
    const confirmOrderBtn = document.getElementById("confirmOrderBtn");
    const thankYouModal = document.getElementById("thankYouModal");
    const decreaseQty = document.getElementById("decreaseQty");
    const increaseQty = document.getElementById("increaseQty");
    const quantityValue = document.getElementById("quantityValue");

    let quantity = 1;

    orderBtn.addEventListener("click", () => orderModal.classList.remove("hidden"));
    orderModal.addEventListener("click", e => { if(e.target === orderModal) orderModal.classList.add("hidden"); });

    decreaseQty.addEventListener("click", () => { if(quantity>1) quantity--; quantityValue.textContent = quantity; });
    increaseQty.addEventListener("click", () => { quantity++; quantityValue.textContent = quantity; });

    confirmOrderBtn.addEventListener("click", async () => {
      const fname = document.getElementById("fname").value.trim();
      const lname = document.getElementById("lname").value.trim();
      const phone = document.getElementById("phone").value.trim();
      const wilaya = document.getElementById("wilaya").value.trim();
      const commune = document.getElementById("commune").value.trim();
      const address = document.getElementById("address").value.trim();
      const deliveryType = document.getElementById("deliveryType").value;
      const note = document.getElementById("note").value.trim();

      if (!fname || !lname || !phone || !wilaya || !commune || !address)
        return alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ø§Ù„Ø¥Ø¬Ø¨Ø§Ø±ÙŠØ© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.");

      orderModal.classList.add("hidden");

      const orderRef = push(ref(db, "orders"));
      const orderId = orderRef.key;
      const totalPrice = parseFloat(product.newPrice) * quantity;

      await set(orderRef, {
        id: orderId,
        productId: productId,
        productName: product.name,
        productPrice: parseFloat(product.newPrice),
        quantity,
        totalPrice,
        customerName: `${fname} ${lname}`,
        customerPhone: phone,
        customerWilaya: wilaya,
        customerCommune: commune,
        customerAddress: address,
        deliveryOption: deliveryType,
        note,
        timestamp: Date.now(),
        status: "Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©",
        rating: 0
      });

      thankYouModal.innerHTML = `
        <div class="modal-content" style="text-align:center;">
          <h3>âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­ Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§</h3>
          <p>Ø±Ù‚Ù… Ø·Ù„Ø¨Ùƒ:</p>
          <div id="orderIdBox" style="background:#f0f0f0;padding:10px;border-radius:8px;margin-bottom:10px;font-weight:bold;">${orderId}</div>
          <button id="copyOrderId" style="background:#4CAF50;color:white;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;margin-bottom:10px;">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„Ø±Ù‚Ù…</button>
          <br>
          <button id="closeModal" style="background:#e74c3c;color:white;padding:8px 20px;border:none;border-radius:6px;cursor:pointer;">Ù…ÙˆØ§ÙÙ‚</button>
        </div>
      `;

      thankYouModal.classList.remove("hidden");
      document.getElementById("copyOrderId").onclick = () => { navigator.clipboard.writeText(orderId); alert("ØªÙ… Ù†Ø³Ø® Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨!"); };
      document.getElementById("closeModal").onclick = () => { thankYouModal.classList.add("hidden"); };
    });

  } catch(err) {
    console.error(err);
    container.innerHTML = '<p class="error-message">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬.</p>';
  }
}

fetchProductDetails();
</script>
<script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
</body>
</html>