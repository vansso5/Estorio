<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</title>
  
  <!-- Ø±Ø¨Ø· Ø§Ù„Ø®Ø· ÙˆØ§Ù„Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ù…ÙˆØ­Ø¯ -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="admin-style.css" />

  <!-- Ù…ÙƒØªØ¨Ø§Øª Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <!-- ØªÙ… Ø¥Ø²Ø§Ù„Ø© Ø¨Ù„Ø§Ø¬Ù† datalabels Ù„Ø£Ù†Ù‡ Ù‚Ø¯ ÙŠØ³Ø¨Ø¨ Ø«Ù‚Ù„ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… ØªÙ‡ÙŠØ¦ØªÙ‡ØŒ ÙŠÙ…ÙƒÙ† Ø¥Ø¹Ø§Ø¯ØªÙ‡ Ø¥Ø°Ø§ Ù„Ø²Ù… Ø§Ù„Ø£Ù…Ø± -->
</head>
<body>

  <nav>
    <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>

    <div class="logo">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <div class="links">
      <a href="admin-products.html" class="nav-link">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a>
      <a href="admin-orders.html" class="nav-link">Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø§Ù„Ù†Ø´Ø·Ø©</a>
      <a href="completed-orders.html" class="nav-link">Ø§Ù„Ø·Ù„Ø¨ÙŠØ§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</a>
      <a href="admin-analytics.html" class="nav-link active">Ø§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</a>
      <a href="admin-settings.html" class="nav-link">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</a>
      <a href="admin-reviews.html" class="nav-link">Ø§Ù„ØªØ¹Ù„ÙŠÙ‚Ø§Øª ÙˆØ§Ù„ØªÙ‚ÙŠÙŠÙ…Ø§Øª</a>
      <a href="admin-shipping.html" class="nav-link">Ø§Ù„Ø´Ø­Ù†</a>
      <a href="#" id="logoutBtn" class="nav-link" style="display: none;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</a>
    </div>
  </nav>

  <div class="container">
    <h2>ğŸ“Š Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„ØªØ­Ù„ÙŠÙ„Ø§Øª</h2>
    
    <!-- Ø´Ø¨ÙƒØ© Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="analytics-grid">
      <div class="stat-card">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
        <div class="value" id="totalSales">0 Ø¯Ø¬</div>
      </div>
      <div class="stat-card">
        <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­</h3>
        <div class="value" id="totalProfit">0 Ø¯Ø¬</div>
      </div>
      <div class="stat-card">
        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <div class="value" id="totalOrders">0</div>
      </div>
      <div class="stat-card">
        <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„Ø·Ù„Ø¨</h3>
        <div class="value" id="avgOrderValue">0 Ø¯Ø¬</div>
      </div>
      <div class="stat-card">
        <h3>Ø£Ø¹Ù„Ù‰ Ù…Ù†ØªØ¬ Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
        <div class="value" id="topProduct">-</div>
        <div class="change" id="topProductSales">0 Ù…Ø¨ÙŠØ¹</div>
      </div>
      <div class="stat-card">
        <h3>Ù…Ø¹Ø¯Ù„ Ø§Ù„Ø¥ÙƒÙ…Ø§Ù„</h3>
        <div class="value" id="completionRate">0%</div>
      </div>
    </div>

    <!-- Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙÙ„ØªØ±Ø© -->
    <div class="chart-container">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
          <h3>ğŸ“ˆ ØªØ·ÙˆØ± Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
          <div class="time-filters">
            <button class="time-btn active" onclick="changeTimeRange('day')">Ø§Ù„ÙŠÙˆÙ…</button>
            <button class="time-btn" onclick="changeTimeRange('week')">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
            <button class="time-btn" onclick="changeTimeRange('month')">Ø§Ù„Ø´Ù‡Ø±</button>
            <button class="time-btn" onclick="changeTimeRange('year')">Ø§Ù„Ø³Ù†Ø©</button>
          </div>
      </div>
      <!-- ØªØ­Ø¯ÙŠØ¯ Ø§Ø±ØªÙØ§Ø¹ Ù„Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø£ÙŠØ¶Ø§Ù‹ Ù„Ù„Ø£Ù…Ø§Ù† -->
      <div style="position: relative; height: 300px; width: 100%;">
        <canvas id="salesChart"></canvas>
      </div>
    </div>

    <div class="charts-row">
      <div class="top-products">
        <h3>ğŸ† Ø£ÙØ¶Ù„ 5 Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¨ÙŠØ¹Ø§Ù‹</h3>
        <div id="topProductsList">
          <p class="loading-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
      </div>
      
      <div class="recent-orders">
        <h3>ğŸ•’ Ø¢Ø®Ø± Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©</h3>
        <div id="recentOrdersList">
          <p class="loading-message">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>
        </div>
      </div>
    </div>

    <div class="chart-container">
      <h3>ğŸ¥§ ØªÙ‚Ø³ÙŠÙ… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
      <!-- [ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø§Ù…] Ø¥Ø¶Ø§ÙØ© Ø­Ø§ÙˆÙŠØ© Ø¨Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù…Ù†Ø¹ Ø§Ù„ÙƒØ±Ø§Ø´ -->
      <div style="position: relative; height: 350px; width: 100%;">
        <canvas id="productsChart"></canvas>
      </div>
      <div id="productsChartLegend" class="chart-legend"></div>
    </div>
  </div>

  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
  import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBUeCV2eX3LgA1X3WcEMcsTIubXN1YlVl4",
    authDomain: "myestore-34f65.firebaseapp.com",
    databaseURL: "https://myestore-34f65-default-rtdb.firebaseio.com",
    projectId: "myestore-34f65",
    storageBucket: "myestore-34f65.firebasestorage.app",
    messagingSenderId: "14078917211",
    appId: "1:14078917211:web:a48eab2a7396c094f7dd7e",
    measurementId: "G-9181DX0XNJ"
  };

  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
  const auth = getAuth(app);
  const ordersRef = ref(database, 'orders');

  let salesChart, productsChart;
  let currentTimeRange = 'day';
  let allCompletedOrders = [];

  const monthNames = ['Ø¬Ø§Ù†ÙÙŠ', 'ÙÙŠÙØ±ÙŠ', 'Ù…Ø§Ø±Ø³', 'Ø£ÙØ±ÙŠÙ„', 'Ù…Ø§ÙŠ', 'Ø¬ÙˆØ§Ù†', 'Ø¬ÙˆÙŠÙ„ÙŠØ©', 'Ø£ÙˆØª', 'Ø³Ø¨ØªÙ…Ø¨Ø±', 'Ø£ÙƒØªÙˆØ¨Ø±', 'Ù†ÙˆÙÙ…Ø¨Ø±', 'Ø¯ÙŠØ³Ù…Ø¨Ø±'];
  const dayNames = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª'];

  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById('logoutBtn').style.display = 'block';
      loadAnalyticsData();
    } else {
      document.getElementById('logoutBtn').style.display = 'none';
      alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„");
      window.location.href = 'admin-login.html';
    }
  });

  document.getElementById('logoutBtn').addEventListener('click', async () => {
    await signOut(auth);
    window.location.href = 'admin-login.html';
  });

  function loadAnalyticsData() {
    onValue(ordersRef, (snapshot) => {
      const allOrders = snapshot.val() || {};
      
      allCompletedOrders = Object.values(allOrders).filter(order =>
        (order.status === 'ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„' || order.status === 'Delivered')
      );

      calculateGeneralStats(allCompletedOrders);
      calculateTopProducts(allCompletedOrders);
      showRecentOrders(allCompletedOrders);
      
      updateCharts(allCompletedOrders);
    });
  }

  function calculateGeneralStats(orders) {
    const totalSales = orders.reduce((sum, order) => sum + parseFloat(order.totalPrice || 0), 0);
    const totalOrdersCount = orders.length;
    const avgOrderValue = totalOrdersCount > 0 ? totalSales / totalOrdersCount : 0;
    const totalProfit = totalSales * 0.30; 

    document.getElementById('totalSales').textContent = totalSales.toLocaleString() + ' Ø¯Ø¬';
    document.getElementById('totalProfit').textContent = totalProfit.toLocaleString() + ' Ø¯Ø¬';
    document.getElementById('totalOrders').textContent = totalOrdersCount;
    document.getElementById('avgOrderValue').textContent = avgOrderValue.toLocaleString() + ' Ø¯Ø¬';
    document.getElementById('completionRate').textContent = totalOrdersCount > 0 ? '100%' : '0%';
  }

  function calculateTopProducts(orders) {
    const productSales = {};
    orders.forEach(order => {
      if (order.items && Array.isArray(order.items)) {
          order.items.forEach(item => {
              const name = item.name || item.productName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
              productSales[name] = (productSales[name] || 0) + parseInt(item.quantity || 1);
          });
      } else {
          const name = order.productName || 'ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ';
          productSales[name] = (productSales[name] || 0) + parseInt(order.quantity || 1);
      }
    });

    const topProducts = Object.entries(productSales).sort((a,b)=>b[1]-a[1]).slice(0,5);
    const topProductsList = document.getElementById('topProductsList');
    topProductsList.innerHTML = '';

    if (topProducts.length > 0) {
      document.getElementById('topProduct').textContent = topProducts[0][0];
      document.getElementById('topProductSales').textContent = topProducts[0][1] + ' Ù…Ø¨ÙŠØ¹';

      const maxSales = topProducts[0][1];
      topProducts.forEach(([name, sales]) => {
        const percentage = (sales / maxSales) * 100;
        const div = document.createElement('div');
        div.className = 'product-item';
        div.innerHTML = `
          <div class="product-info" style="width:100%">
            <div style="display:flex; justify-content:space-between; font-size:0.9rem;">
                <strong>${name}</strong>
                <span>${sales} Ù…Ø¨ÙŠØ¹</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" style="width:${percentage}%"></div></div>
          </div>
        `;
        topProductsList.appendChild(div);
      });
    }
  }

  function showRecentOrders(orders) {
    const recent = orders.sort((a,b)=>(b.updatedAt || b.timestamp)-(a.updatedAt || a.timestamp)).slice(0,5);
    const list = document.getElementById('recentOrdersList');
    list.innerHTML = '';
    
    recent.forEach(order => {
      const div = document.createElement('div');
      div.className = 'order-item';
      div.innerHTML = `
        <div class="order-info">
          <strong>${order.customerName || 'Ø²Ø¨ÙˆÙ†'}</strong>
          <div style="font-size:0.8rem; color:#666;">${order.productName || 'Ù…Ù†ØªØ¬'}</div>
        </div>
        <div class="order-status">
          <div>${parseFloat(order.totalPrice).toLocaleString()} Ø¯Ø¬</div>
          <div class="status-delivered" style="color:var(--success-color); font-size:0.8rem;">ØªÙ… Ø§Ù„ØªÙˆØµÙŠÙ„</div>
        </div>
      `;
      list.appendChild(div);
    });
  }

  /* --- Ø¯ÙˆØ§Ù„ Ø§Ù„Ù…Ø®Ø·Ø·Ø§Øª ÙˆØ§Ù„ÙˆÙ‚Øª --- */

  window.changeTimeRange = function(range) {
    currentTimeRange = range;
    document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
    
    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
    const buttons = document.querySelectorAll('.time-btn');
    if(range === 'day') buttons[0].classList.add('active');
    if(range === 'week') buttons[1].classList.add('active');
    if(range === 'month') buttons[2].classList.add('active');
    if(range === 'year') buttons[3].classList.add('active');

    updateSalesChart(allCompletedOrders);
  };

  function updateCharts(orders) {
    updateSalesChart(orders);
    updateProductsChart(orders);
  }

  function updateSalesChart(orders) {
    const ctx = document.getElementById('salesChart').getContext('2d');
    if (salesChart) salesChart.destroy();

    const { labels, data } = processSalesData(orders, currentTimeRange);

    salesChart = new Chart(ctx, {
      type:'line',
      data:{
        labels: labels,
        datasets:[{
          label:'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
          data: data,
          borderColor:'#667eea',
          backgroundColor:'rgba(102,126,234,0.1)',
          borderWidth:3,
          fill:true,
          tension:0.4,
          pointRadius: 4
        }]
      },
      options:{
        responsive:true,
        maintainAspectRatio: false, // ÙŠØ¹Ù…Ù„ Ø§Ù„Ø¢Ù† Ù„Ø£Ù† Ø§Ù„Ø£Ø¨ Ù„Ù‡ Ø§Ø±ØªÙØ§Ø¹ Ù…Ø­Ø¯Ø¯
        plugins:{
           legend:{display:false},
           tooltip: {
             callbacks: {
               label: function(context) { return context.parsed.y.toLocaleString() + ' Ø¯Ø¬'; }
             }
           }
        },
        scales:{
          y:{beginAtZero:true}
        }
      }
    });
  }

  function processSalesData(orders, range) {
    let labels = [];
    let data = [];
    const now = new Date();

    if (range === 'day') {
        labels = ['00:00', '03:00', '06:00', '09:00', '12:00', '15:00', '18:00', '21:00'];
        data = new Array(8).fill(0);
        
        orders.forEach(order => {
            const d = new Date(order.updatedAt || order.timestamp);
            if (d.getDate() === now.getDate() && d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) {
                const hour = d.getHours();
                const index = Math.floor(hour / 3);
                if(index < 8) data[index] += parseFloat(order.totalPrice || 0);
            }
        });

    } else if (range === 'week') {
        for(let i=6; i>=0; i--) {
            const d = new Date();
            d.setDate(now.getDate() - i);
            labels.push(dayNames[d.getDay()]);
            
            let total = 0;
            orders.forEach(order => {
                const od = new Date(order.updatedAt || order.timestamp);
                if (od.getDate() === d.getDate() && od.getMonth() === d.getMonth() && od.getFullYear() === d.getFullYear()) {
                    total += parseFloat(order.totalPrice || 0);
                }
            });
            data.push(total);
        }

    } else if (range === 'month') {
        labels = ['Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 1', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 2', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 3', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 4', 'Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ 5'];
        data = new Array(5).fill(0);
        
        orders.forEach(order => {
            const d = new Date(order.updatedAt || order.timestamp);
            if (d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear()) {
                const day = d.getDate();
                const index = Math.floor((day - 1) / 7);
                if(index < 5) data[index] += parseFloat(order.totalPrice || 0);
            }
        });

    } else if (range === 'year') {
        labels = monthNames;
        data = new Array(12).fill(0);
        
        orders.forEach(order => {
            const d = new Date(order.updatedAt || order.timestamp);
            if (d.getFullYear() === now.getFullYear()) {
                const month = d.getMonth();
                data[month] += parseFloat(order.totalPrice || 0);
            }
        });
    }

    return { labels, data };
  }

  // [ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø§Ù…] ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ÙƒØªØ§Ø¨Ø© Ø¯Ø§Ù„Ø© Ù…Ø®Ø·Ø· Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„ØªÙƒÙˆÙ† Ø®ÙÙŠÙØ© ÙˆØ³Ø±ÙŠØ¹Ø©
  function updateProductsChart(orders) {
    const ctx = document.getElementById('productsChart').getContext('2d');
    if (productsChart) productsChart.destroy();

    // 1. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    const productSales = {};
    orders.forEach(o => {
        const price = parseFloat(o.totalPrice || 0);
        const name = o.productName || 'Ù…Ù†ØªØ¬';
        productSales[name] = (productSales[name] || 0) + price;
    });

    // 2. Ø§Ù„ØªØ±ØªÙŠØ¨
    const sortedProducts = Object.entries(productSales).sort((a,b)=>b[1]-a[1]);
    const totalSales = sortedProducts.reduce((sum,[,v])=>sum+v,0);
    
    if(totalSales === 0) return;

    // 3. Ø£Ø®Ø° Ø£ÙØ¶Ù„ 5 Ù…Ù†ØªØ¬Ø§Øª ÙÙ‚Ø· ÙˆØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ø§Ù‚ÙŠ Ù„ØªØ®ÙÙŠÙ Ø§Ù„Ø«Ù‚Ù„
    let finalLabels = [];
    let finalData = [];
    let otherSales = 0;

    sortedProducts.forEach((item, index) => {
        if (index < 5) {
            finalLabels.push(item[0]);
            finalData.push(item[1]);
        } else {
            otherSales += item[1];
        }
    });

    if (otherSales > 0) {
        finalLabels.push('Ù…Ù†ØªØ¬Ø§Øª Ø£Ø®Ø±Ù‰');
        finalData.push(otherSales);
    }

    const legendContainer = document.getElementById('productsChartLegend');
    legendContainer.innerHTML = '';

    // Ø£Ù„ÙˆØ§Ù† Ø«Ø§Ø¨ØªØ©
    const colors = ['#667eea','#764ba2','#f093fb','#4facfe','#43e97b','#ff9a9e'];

    productsChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
          labels: finalLabels,
          datasets: [{
              data: finalData,
              backgroundColor: colors.slice(0, finalLabels.length),
              borderWidth: 2,
              borderColor: '#fff'
          }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false, // Ù„Ù† ÙŠØ³Ø¨Ø¨ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„Ø¢Ù† Ø¨Ø³Ø¨Ø¨ Ø§Ù„Ø­Ø§ÙˆÙŠØ© ÙÙŠ HTML
        cutout: '70%',
        plugins: {
          legend: { display: false },
          tooltip: {
              callbacks: {
                  label: function(context) {
                      let value = context.parsed;
                      let percentage = ((value / totalSales) * 100).toFixed(1) + '%';
                      return context.label + ': ' + percentage;
                  }
              }
          }
        }
      }
    });

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù„ÙŠØ¬Ù†Ø¯ (Legend)
    finalLabels.forEach((name, i) => {
      const sales = finalData[i];
      const percentage = ((sales/totalSales)*100);
      const legendItem = document.createElement('div');
      legendItem.className = 'legend-item';
      legendItem.innerHTML = `
        <div style="display:flex; align-items:center; gap:5px;">
            <span class="color-box" style="background-color:${colors[i]||'#ccc'}"></span>
            <span>${name}</span>
        </div>
        <span class="percentage">${percentage < 0.1 ? '<0.1' : percentage.toFixed(1)}%</span>
      `;
      legendContainer.appendChild(legendItem);
    });
  }
  </script>

  <!-- Ø³ÙƒØ±Ø¨Øª Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
  <script>
    function toggleMenu() {
      const links = document.querySelector('nav .links');
      links.classList.toggle('open');
    }
  </script>
</body>
</html>