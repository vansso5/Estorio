<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ุฅุนุฏุงุฏุงุช ุงูุดุญู</title>
  
  <!-- ุฑุจุท ุงูุฎุท ูุงูุณุชุงูู ุงูููุญุฏ -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="admin-style.css" />
</head>
<body>

  <nav>
  <div class="logo">ููุญุฉ ุงูุชุญูู</div>
  <div class="links">
    <a href="admin-products.html" class="nav-link">ุงูููุชุฌุงุช</a>
    <a href="admin-orders.html" class="nav-link">ุงูุทูุจูุงุช ุงููุดุทุฉ</a>
    <a href="completed-orders.html" class="nav-link">ุงูุทูุจูุงุช ุงูููุชููุฉ</a>
    <a href="admin-analytics.html" class="nav-link">ุงูุชุญูููุงุช</a>
    <a href="admin-settings.html" class="nav-link">ุงูุฅุนุฏุงุฏุงุช</a>
    <a href="admin-reviews.html" class="nav-link">ุงูุชุนูููุงุช ูุงูุชููููุงุช</a>
    <a href="admin-shipping.html" class="nav-link active">ุงูุดุญู</a>
    <a href="#" id="logoutBtn" class="nav-link" style="display: none;">ุชุณุฌูู ุงูุฎุฑูุฌ</a>
  </div>
</nav>

  <div class="container">
    <h2>๐ ุฅุฏุงุฑุฉ ููุงุทู ูุชุณุนูุฑุงุช ุงูุชูุตูู</h2>

    <div class="form-card">
      <h3 style="margin-top:0;">โ ุฅุถุงูุฉ ุชุณุนูุฑุฉ ุฌุฏูุฏุฉ</h3>
      
      <div class="price-inputs-row">
        <div class="price-group">
          <label>๐ ุชูุตูู ููููุฒู (ุฏุฌ)</label>
          <input type="number" id="homePrice" placeholder="600" required>
        </div>
        <div class="price-group">
          <label>๐ข ุชูุตูู ููููุชุจ (Stop Desk) (ุฏุฌ)</label>
          <input type="number" id="deskPrice" placeholder="400" required>
        </div>
      </div>

      <div class="wilaya-section">
        <div class="wilaya-controls">
          <h4 style="margin:0;">ุงุฎุชุฑ ุงูููุงูุงุช:</h4>
          <button type="button" id="selectAllBtn" class="select-all-btn">ุชุญุฏูุฏ ุงููู</button>
        </div>
        <div id="wilayaGrid" class="wilaya-grid"></div>
      </div>

      <button id="saveZoneBtn">๐พ ุญูุธ ุงูุชุณุนูุฑุฉ</button>
    </div>

    <h3 style="border-bottom: 2px solid #ddd; padding-bottom: 10px; margin-top: 40px;">๐ ุงูุชุณุนูุฑุงุช ุงููุญููุธุฉ</h3>
    
    <div id="zonesContainer" class="zones-grid">
      <p class="loading-message">ุฌุงุฑู ุชุญููู ุงูุจูุงูุงุช...</p>
    </div>
  </div>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyBUeCV2eX3LgA1X3WcEMcsTIubXN1YlVl4",
      authDomain: "myestore-34f65.firebaseapp.com",
      databaseURL: "https://myestore-34f65-default-rtdb.firebaseio.com",
      projectId: "myestore-34f65",
      storageBucket: "myestore-34f65.firebasestorage.app",
      messagingSenderId: "14078917211",
      appId: "1:14078917211:web:a48eab2a7396c094f7dd7e",
      measurementId: "G-9181DX0XNJ"
    };

    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);
    const zonesRef = ref(db, 'shipping_zones');

    const wilayaGrid = document.getElementById('wilayaGrid');
    const saveZoneBtn = document.getElementById('saveZoneBtn');
    const zonesContainer = document.getElementById('zonesContainer');
    const homePriceInput = document.getElementById('homePrice');
    const deskPriceInput = document.getElementById('deskPrice');
    const selectAllBtn = document.getElementById('selectAllBtn');
    const logoutBtn = document.getElementById('logoutBtn');

    const allWilayas = [
      "01. ุฃุฏุฑุงุฑ", "02. ุงูุดูู", "03. ุงูุฃุบูุงุท", "04. ุฃู ุงูุจูุงูู", "05. ุจุงุชูุฉ", "06. ุจุฌุงูุฉ", "07. ุจุณูุฑุฉ", "08. ุจุดุงุฑ", 
      "09. ุงูุจููุฏุฉ", "10. ุงูุจููุฑุฉ", "11. ุชููุฑุงุณุช", "12. ุชุจุณุฉ", "13. ุชููุณุงู", "14. ุชูุงุฑุช", "15. ุชูุฒู ูุฒู", "16. ุงูุฌุฒุงุฆุฑ", 
      "17. ุงูุฌููุฉ", "18. ุฌูุฌู", "19. ุณุทูู", "20. ุณุนูุฏุฉ", "21. ุณูููุฏุฉ", "22. ุณูุฏู ุจูุนุจุงุณ", "23. ุนูุงุจุฉ", "24. ูุงููุฉ", 
      "25. ูุณูุทููุฉ", "26. ุงููุฏูุฉ", "27. ูุณุชุบุงูู", "28. ุงููุณููุฉ", "29. ูุนุณูุฑ", "30. ูุฑููุฉ", "31. ููุฑุงู", "32. ุงูุจูุถ", 
      "33. ุฅููุฒู", "34. ุจุฑุฌ ุจูุนุฑูุฑูุฌ", "35. ุจููุฑุฏุงุณ", "36. ุงูุทุงุฑู", "37. ุชูุฏูู", "38. ุชูุณูุณููุช", "39. ุงููุงุฏู", "40. ุฎูุดูุฉ", 
      "41. ุณูู ุฃูุฑุงุณ", "42. ุชูุจุงุฒุฉ", "43. ูููุฉ", "44. ุนูู ุงูุฏููู", "45. ุงููุนุงูุฉ", "46. ุนูู ุชููุดูุช", "47. ุบุฑุฏุงูุฉ", "48. ุบููุฒุงู", 
      "49. ุชูููููู", "50. ุจุฑุฌ ุจุงุฌู ูุฎุชุงุฑ", "51. ุฃููุงุฏ ุฌูุงู", "52. ุจูู ุนุจุงุณ", "53. ุฅู ุตุงูุญ", "54. ุฅู ูุฒุงู", "55. ุชูุฑุช", 
      "56. ุฌุงูุช", "57. ุงููุบูุฑ", "58. ุงููููุนุฉ"
    ];

    onAuthStateChanged(auth, (user) => {
      if (user) {
        logoutBtn.style.display = 'block';
        renderWilayaCheckboxes();
      } else {
        window.location.href = 'admin-login.html';
      }
    });

    logoutBtn.addEventListener('click', async () => {
        await signOut(auth);
        window.location.href = 'admin-login.html';
    });

    function renderWilayaCheckboxes() {
        wilayaGrid.innerHTML = '';
        allWilayas.forEach(wilaya => {
            const label = document.createElement('label');
            label.className = 'wilaya-checkbox-item';
            // ุญูุธ ุงูุงุณู ููุท ุจุฏูู ุงูุฑูู ููุทุงุจู ูุงุฆูุฉ ุงูุฒุจูู
            const cleanName = wilaya.split('. ')[1]; 
            label.innerHTML = `<input type="checkbox" value="${cleanName}" class="wilaya-check"><span>${wilaya}</span>`;
            wilayaGrid.appendChild(label);
        });
    }

    let allSelected = false;
    selectAllBtn.addEventListener('click', () => {
        const checkboxes = document.querySelectorAll('.wilaya-check');
        allSelected = !allSelected;
        checkboxes.forEach(cb => cb.checked = allSelected);
        selectAllBtn.textContent = allSelected ? "ุฅูุบุงุก ุงูุชุญุฏูุฏ" : "ุชุญุฏูุฏ ุงููู";
        // ุชุบููุฑ ููู ุงูุฒุฑ ุนูุฏ ุงูุชุญุฏูุฏ ุงููุงูู
        if(allSelected) {
            selectAllBtn.style.backgroundColor = "var(--error-color)";
        } else {
            selectAllBtn.style.backgroundColor = "var(--primary-color)";
        }
    });

    saveZoneBtn.addEventListener('click', async () => {
      const homePrice = parseFloat(homePriceInput.value);
      const deskPrice = parseFloat(deskPriceInput.value);
      const selectedWilayas = [];
      document.querySelectorAll('.wilaya-check:checked').forEach(cb => selectedWilayas.push(cb.value));

      if (!homePrice || !deskPrice) { alert("โ๏ธ ุฃุฏุฎู ุงูุฃุณุนุงุฑ ุฃููุงู."); return; }
      if (selectedWilayas.length === 0) { alert("โ๏ธ ุงุฎุชุฑ ููุงูุฉ ูุงุญุฏุฉ ุนูู ุงูุฃูู."); return; }

      try {
        await push(zonesRef, {
          homePrice: homePrice,
          deskPrice: deskPrice,
          wilayas: selectedWilayas,
          createdAt: Date.now()
        });
        alert("โ ุชู ุงูุญูุธ!");
        // ุฅุนุงุฏุฉ ุชุนููู ุงููููุฐุฌ
        homePriceInput.value = '';
        deskPriceInput.value = '';
        document.querySelectorAll('.wilaya-check').forEach(cb => cb.checked = false);
        allSelected = false;
        selectAllBtn.textContent = "ุชุญุฏูุฏ ุงููู";
        selectAllBtn.style.backgroundColor = "var(--primary-color)";
      } catch (error) {
        alert("โ ุฎุทุฃ: " + error.message);
      }
    });

    onValue(zonesRef, (snapshot) => {
      zonesContainer.innerHTML = '';
      if (snapshot.exists()) {
        const zones = snapshot.val();
        Object.entries(zones).forEach(([key, zone]) => {
          const wilayasText = Array.isArray(zone.wilayas) ? zone.wilayas.join('ุ ') : 'ูุง ููุฌุฏ';
          const count = Array.isArray(zone.wilayas) ? zone.wilayas.length : 0;

          const div = document.createElement('div');
          div.className = 'zone-card';
          div.innerHTML = `
            <div class="zone-header"><strong>ูุฌููุนุฉ (${count} ููุงูุงุช)</strong></div>
            <div class="zone-prices">
              <div class="price-tag home">๐ ููุฒู: ${zone.homePrice} ุฏุฌ</div>
              <div class="price-tag desk">๐ข ููุชุจ: ${zone.deskPrice} ุฏุฌ</div>
            </div>
            <div class="zone-wilayas">${wilayasText}</div>
            <div class="zone-actions">
              <!-- ุงุณุชุฎุฏุงู ููุงุณุงุช CSS ุงูููุญุฏุฉ ุจุฏูุงู ูู ุงูุณุชุงูู ุงููุถูู -->
              <button class="delete-btn" data-id="${key}" style="padding: 6px 12px; font-size: 0.85rem;">๐๏ธ ุญุฐู</button>
            </div>
          `;
          zonesContainer.appendChild(div);
        });
        
        // ุชูุนูู ุฒุฑ ุงูุญุฐู
        document.querySelectorAll('.delete-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            if(confirm("ุญุฐู ูุฐู ุงูุชุณุนูุฑุฉุ")) remove(ref(db, `shipping_zones/${e.target.dataset.id}`));
          });
        });
      } else {
        zonesContainer.innerHTML = '<p class="loading-message">ูุง ุชูุฌุฏ ุชุณุนูุฑุงุช ูุญููุธุฉ.</p>';
      }
    });
  </script>
</body>
</html>